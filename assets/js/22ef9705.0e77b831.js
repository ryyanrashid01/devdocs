"use strict";(self.webpackChunkdeploy_to_vm=self.webpackChunkdeploy_to_vm||[]).push([[475],{6600:(e,s,n)=>{n.d(s,{A:()=>i});const i=n.p+"assets/images/github_deployment-d7db99459c07a0014816281fd6f8cf02.png"},8453:(e,s,n)=>{n.d(s,{R:()=>o,x:()=>l});var i=n(6540);const r={},t=i.createContext(r);function o(e){const s=i.useContext(t);return i.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function l(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),i.createElement(t.Provider,{value:s},e.children)}},9338:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>d,contentTitle:()=>l,default:()=>a,frontMatter:()=>o,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"Deploying to Virtual Machine/GitHub Deploy Keys","title":"GitHub Deploy Keys","description":"When deploying a website from a private GitHub repository to a server (like a DigitalOcean droplet), you need a secure way for the server to access the repo without exposing your personal credentials. This is where deploy keys come in.","source":"@site/docs/Deploying to Virtual Machine/GitHub Deploy Keys.md","sourceDirName":"Deploying to Virtual Machine","slug":"/Deploying to Virtual Machine/GitHub Deploy Keys","permalink":"/devdocs/docs/Deploying to Virtual Machine/GitHub Deploy Keys","draft":false,"unlisted":false,"editUrl":"https://github.com/ryyanrashid01/devdocs/docs/Deploying to Virtual Machine/GitHub Deploy Keys.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2},"sidebar":"tutorialSidebar","previous":{"title":"Droplet Setup","permalink":"/devdocs/docs/Deploying to Virtual Machine/Droplet Setup"},"next":{"title":"Reverse Proxy with Nginx","permalink":"/devdocs/docs/Deploying to Virtual Machine/Reverse Proxy with Nginx"}}');var r=n(4848),t=n(8453);const o={sidebar_position:2},l=void 0,d={},c=[{value:"What Is a Deploy Key?",id:"what-is-a-deploy-key",level:2},{value:"Step-by-Step Guide to Using Deploy Keys",id:"step-by-step-guide-to-using-deploy-keys",level:2},{value:"Step 1: Generate SSH Key Pair on the Server or CI Runner",id:"step-1-generate-ssh-key-pair-on-the-server-or-ci-runner",level:3},{value:"Step 2: Add the Public Key to Your GitHub Repository",id:"step-2-add-the-public-key-to-your-github-repository",level:3},{value:"Step 3: Configure Your Server to Use the Deploy Key",id:"step-3-configure-your-server-to-use-the-deploy-key",level:3},{value:"Step 4: Clone or Update Your Repository on the Server",id:"step-4-clone-or-update-your-repository-on-the-server",level:3},{value:"Optional: Using Deploy Keys in GitHub Actions",id:"optional-using-deploy-keys-in-github-actions",level:3},{value:"Troubleshooting Tips",id:"troubleshooting-tips",level:2}];function h(e){const s={a:"a",code:"code",em:"em",h2:"h2",h3:"h3",hr:"hr",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(s.p,{children:["When deploying a website from a private GitHub repository to a server (like a DigitalOcean droplet), you need a secure way for the server to access the repo without exposing your personal credentials. This is where ",(0,r.jsx)(s.strong,{children:"deploy keys"})," come in."]}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h2,{id:"what-is-a-deploy-key",children:"What Is a Deploy Key?"}),"\n",(0,r.jsxs)(s.p,{children:["A ",(0,r.jsx)(s.strong,{children:"deploy key"})," is an SSH key pair where:"]}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["The ",(0,r.jsx)(s.strong,{children:"public key"})," is added to a single GitHub repository\u2019s settings (not user settings) (under ",(0,r.jsx)(s.em,{children:"Deploy keys"}),")."]}),"\n",(0,r.jsxs)(s.li,{children:["The ",(0,r.jsx)(s.strong,{children:"private key"})," is stored securely on your server or in your CI/CD pipeline."]}),"\n",(0,r.jsxs)(s.li,{children:["This allows the server to authenticate with GitHub ",(0,r.jsx)(s.em,{children:"only for that repository"})," \u2014 limiting scope and improving security."]}),"\n",(0,r.jsxs)(s.li,{children:["You can grant the key ",(0,r.jsx)(s.strong,{children:"read-only"})," access (default) or ",(0,r.jsx)(s.strong,{children:"read/write"})," access if the server needs to push changes."]}),"\n"]}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h2,{id:"step-by-step-guide-to-using-deploy-keys",children:"Step-by-Step Guide to Using Deploy Keys"}),"\n",(0,r.jsx)(s.h3,{id:"step-1-generate-ssh-key-pair-on-the-server-or-ci-runner",children:"Step 1: Generate SSH Key Pair on the Server or CI Runner"}),"\n",(0,r.jsx)(s.p,{children:"Run this on your server or your CI environment (or generate locally and copy over):"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:'ssh-keygen -t ed25519 -C "deploy-key-for-github" -f ~/.ssh/deploy_key -N ""\n'})}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"-t ed25519"}),": Specifies the Ed25519 algorithm, which is modern and secure."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"-C"}),": Adds a comment to identify the key."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"-f"}),": Specifies the filename."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:'-N ""'}),": Creates the key with no passphrase for automated use."]}),"\n"]}),"\n",(0,r.jsx)(s.p,{children:"This generates:"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"~/.ssh/deploy_key"})," (private key) \u2014 keep this secure and never share publicly."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"~/.ssh/deploy_key.pub"})," (public key) \u2014 this will be uploaded to GitHub."]}),"\n"]}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h3,{id:"step-2-add-the-public-key-to-your-github-repository",children:"Step 2: Add the Public Key to Your GitHub Repository"}),"\n",(0,r.jsxs)(s.ol,{children:["\n",(0,r.jsx)(s.li,{children:"Open your GitHub repo in a browser."}),"\n",(0,r.jsxs)(s.li,{children:["Navigate to ",(0,r.jsx)(s.strong,{children:"Settings"})," > ",(0,r.jsx)(s.strong,{children:"Deploy keys"}),"."]}),"\n",(0,r.jsxs)(s.li,{children:["Click ",(0,r.jsx)(s.strong,{children:"Add deploy key"}),"."]}),"\n"]}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.img,{alt:"GitHub deploy keys",src:n(6600).A+"",width:"2343",height:"1210"})}),"\n",(0,r.jsxs)(s.ol,{start:"4",children:["\n",(0,r.jsx)(s.li,{children:'Give the key a descriptive title (e.g., "DigitalOcean Server Deploy Key").'}),"\n",(0,r.jsxs)(s.li,{children:["Paste the contents of ",(0,r.jsx)(s.code,{children:"~/.ssh/deploy_key.pub"})," into the key field."]}),"\n",(0,r.jsxs)(s.li,{children:["Decide if the key needs ",(0,r.jsx)(s.strong,{children:"write access"})," (usually not required for deployment; leave unchecked for better security)."]}),"\n",(0,r.jsxs)(s.li,{children:["Click ",(0,r.jsx)(s.strong,{children:"Add key"}),"."]}),"\n"]}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.em,{children:"Why:"})," This step authorizes your server to clone and pull from your private repo using SSH, but only for this repo."]}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h3,{id:"step-3-configure-your-server-to-use-the-deploy-key",children:"Step 3: Configure Your Server to Use the Deploy Key"}),"\n",(0,r.jsxs)(s.ol,{children:["\n",(0,r.jsxs)(s.li,{children:["Copy the private key (",(0,r.jsx)(s.code,{children:"deploy_key"}),") to your server\u2019s ",(0,r.jsx)(s.code,{children:"~/.ssh"})," directory if you generated it elsewhere."]}),"\n",(0,r.jsx)(s.li,{children:"Set the correct permissions to keep the key secure:"}),"\n"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"chmod 600 ~/.ssh/deploy_key\n"})}),"\n",(0,r.jsxs)(s.ol,{start:"3",children:["\n",(0,r.jsxs)(s.li,{children:["Create or edit your SSH config file at ",(0,r.jsx)(s.code,{children:"~/.ssh/config"})," to tell SSH which key to use for GitHub:"]}),"\n"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"nano ~/.ssh/config\n"})}),"\n",(0,r.jsx)(s.p,{children:"Add the following:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"  Host github.com\r\n\tHostName github.com\r\n\tUser git\r\n\tIdentityFile ~/.ssh/deploy_key\r\n\tIdentitiesOnly yes\n"})}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.em,{children:"Why:"})," SSH needs to know which key to use when connecting to GitHub. This prevents conflicts if you have multiple keys."]}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h3,{id:"step-4-clone-or-update-your-repository-on-the-server",children:"Step 4: Clone or Update Your Repository on the Server"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"To clone the repository"})," (if you haven\u2019t already):"]}),"\n"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"git clone git@github.com:your-username/your-repo.git /var/www/your-site\n"})}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"To update the repo"})," (after initial clone):"]}),"\n"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"cd /var/www/your-site\r\ngit fetch origin\r\ngit reset --hard origin/main\n"})}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.em,{children:"Why:"})," This fetches your latest website code so your server can serve the current version."]}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h3,{id:"optional-using-deploy-keys-in-github-actions",children:"Optional: Using Deploy Keys in GitHub Actions"}),"\n",(0,r.jsx)(s.p,{children:"If you plan to automate deployments whenever you push to GitHub, you can use the deploy key in a GitHub Actions workflow."}),"\n",(0,r.jsx)(s.p,{children:"This involves storing the private key as a GitHub secret and using it to SSH into your server during deployment."}),"\n",(0,r.jsxs)(s.p,{children:["You don\u2019t need to set this up right now, but if you're interested in automating your deployment process, see the ",(0,r.jsx)(s.a,{href:"./GitHub%20Actions",children:"GitHub Actions"})," for step-by-step instructions."]}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.em,{children:"Why:"})," This lets your GitHub workflow securely authenticate to your server and update the website code automatically. You can trigger deployments on various events, such as:"]}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"When you push to the main branch"}),"\n",(0,r.jsx)(s.li,{children:"When a pull request is merged"}),"\n",(0,r.jsxs)(s.li,{children:["On a manual trigger (using the ",(0,r.jsx)(s.code,{children:"workflow_dispatch"})," event)"]}),"\n",(0,r.jsxs)(s.li,{children:["On a schedule (e.g. nightly builds using ",(0,r.jsx)(s.code,{children:"schedule"}),")"]}),"\n"]}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h2,{id:"troubleshooting-tips",children:"Troubleshooting Tips"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Permission denied (publickey)"})," errors mean the SSH key isn\u2019t configured correctly or the key isn\u2019t added to GitHub."]}),"\n",(0,r.jsxs)(s.li,{children:["Check permissions on your private key (",(0,r.jsx)(s.code,{children:"chmod 600 ~/.ssh/deploy_key"}),")."]}),"\n",(0,r.jsx)(s.li,{children:"Verify SSH connection with:"}),"\n"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"ssh -T git@github.com\n"})}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"If you have multiple SSH keys, make sure your SSH config file specifies the correct one for GitHub."}),"\n"]})]})}function a(e={}){const{wrapper:s}={...(0,t.R)(),...e.components};return s?(0,r.jsx)(s,{...e,children:(0,r.jsx)(h,{...e})}):h(e)}}}]);